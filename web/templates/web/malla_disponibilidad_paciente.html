{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="container mt-4">
    <h5 class="text-muted mb-1">Paso 3: Selecciona la franja disponible</h5>
    

    <h4 class="fw-bold text-secondary">üë§ Paciente: {{ paciente.nombres }} {{ paciente.apellidos }}</h4>

    <div class="mb-3">
      <a href="{% url 'crear_cita_paciente' %}" class="btn btn-outline-secondary">‚¨ÖÔ∏è Cancelar y volver</a>
    </div>

    <div class="d-flex justify-content-between my-3">
        {% if hay_anteriores %}
            <a href="?pagina={{ pagina|add:"-1" }}" class="btn btn-outline-primary">‚¨ÖÔ∏è Anterior</a>
        {% else %}
            <span></span>
        {% endif %}
        {% if hay_mas %}
            <a href="?pagina={{ pagina|add:"1" }}" class="btn btn-outline-primary">Siguiente ‚û°Ô∏è</a>
        {% endif %}
    </div>

    <h2 class="mb-4 fw-bold">üóìÔ∏è Disponibilidad de citas</h2>

    <ul class="nav nav-tabs fw-bold text-dark" id="myTab" role="tablist" style="font-size: 1.1rem;">
        {% for dia in malla %}
            <li class="nav-item" role="presentation">
                <button class="nav-link {% if forloop.first %}active{% endif %}" id="tab-{{ forloop.counter }}" data-bs-toggle="tab" data-bs-target="#dia-{{ forloop.counter }}" type="button" role="tab">
                    {{ dia.fecha|date:"l d/m" }}
                </button>
            </li>
        {% endfor %}
    </ul>

    <div class="tab-content mt-3" style="font-size: 1.05rem;">
        {% for dia in malla %}
        <div class="tab-pane fade {% if forloop.first %}show active{% endif %}" id="dia-{{ forloop.counter }}" role="tabpanel">
            {% if dia.disponibles %}
                {% for espacio in dia.disponibles %}
                <div class="border border-1 rounded-3 mb-3 p-3 shadow-sm" style="background-color: #f8f9fc;">
                    <div class="d-flex flex-column justify-content-center">
                        <div class="mb-2 text-primary fw-bold" style="font-size: 1.25rem;">
                            {{ espacio.hora }}
                        </div>
                        <div class="mb-2 text-start" style="font-size: 1.1rem;">
                            <div><strong class="text-dark" style="font-size: 1.3rem;">{{ tratamiento_seleccionado }}</strong></div>
                            <div class="text-muted">Odont√≥logo: {{ odontologo_seleccionado }}</div>
                            <div class="text-muted">Cl√≠nica: Sede Norte</div>
                            <div class="text-muted">Cabina: {{ espacio.cabina }}</div>
                        </div>
                        <div class="text-end mt-2">
                            <form method="post" action="{% url 'guardar_cita_paciente' %}">
                                {% csrf_token %}
                                <input type="hidden" name="fecha" value="{{ dia.fecha|date:'Y-m-d' }}">
                                <input type="hidden" name="hora" value="{{ espacio.hora }}">
                                <input type="hidden" name="cabina" value="{{ espacio.cabina }}">
                                <input type="hidden" name="tratamiento_id" value="{{ tratamiento_id }}">
                                <input type="hidden" name="odontologo_id" value="{{ odontologo_id }}">
                                {% if reprogramar_id %}
                                  <input type="hidden" name="reprogramar_id" value="{{ reprogramar_id }}">
                                {% endif %}
                                <button type="submit" class="btn btn-primary px-4">Agendar cita</button>
                            </form>                            
                        </div>
                    </div>
                    <hr style="border-top: 3px solid #cce0ff; margin-top: 1rem;">
                </div>
                {% endfor %}
            {% else %}
                <div class="alert alert-warning">No hay espacios disponibles para este d√≠a.</div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>

<script>
    window.addEventListener("load", function () {
        const loader = document.getElementById("loader");
        if (loader) {
            loader.style.display = "none";
        }
    });
</script>

{% endblock %}
